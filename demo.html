<html>
<head>
  <title>Executable Demonstrations</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 

  <!-- TODO: most of the css before the '*' can be removed. -->

  <style>
    #container{ margin: 0 auto; width: 800px; }

    /* Debug borders */
    /* p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 { border: 1px solid red; } */

    body { font-size: 14px; line-height: 20px; margin: 1em 5% 1em 5%; font-family: Verdana, Arial, Helvetica, sans-serif; }
    a { color: #336; text-decoration: underline; }
    a:visited { color: #334; }
    em { font-style: italic; }
    strong { font-weight: bold; }
    tt { color: navy; }

    h1, h2, h3, h4, h5, h6 { color: #223; margin-top: 1.2em; margin-bottom: 0.5em; line-height: 1.3; }
    h1 { border-bottom: 2px solid silver; }
    h2 { border-bottom: 2px solid silver; padding-top: 0.5em; }

    hr { color: #ccc; margin-top: 1.6em; }

    p { color: #222; text-align: justify; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.4em; }

    /* pre { padding: 10; margin: 0; font-family: monospace; font-size: 0.9em; } */

    pre.pass { color: green; }
    pre.fail { color: red; }
    pre.error { color: red; font-weight: bold; }

    span#author { color: #527bbd; font-weight: bold; font-size: 1.1em; }
    span#email { }
    span#revision { }

    div#footer { font-size: small; border-top: 2px solid silver; padding-top: 0.5em; margin-top: 4.0em; }
    div#footer-text { float: left; padding-bottom: 0.5em; }
    div#footer-badges { float: right; padding-bottom: 0.5em; }

    /* Block element content. */
    div.content { padding: 0; }

    /* Block element titles. */
    h1.title { font-weight: bold; text-align: left; font-size: 3em; margin-top: 1.0em; margin-bottom: 0.5em; }

    /* Block element titles. */
    div.title, caption.title { font-weight: bold; text-align: left; margin-top: 1.0em; margin-bottom: 0.5em; }
    div.title + * { margin-top: 0; }
    td div.title:first-child { margin-top: 0.0em; }
    div.content div.title:first-child { margin-top: 0.0em; }
    div.content + div.title { margin-top: 0.0em; }
    div.sidebarblock > div.content { background: #ffffee; border: 1px solid silver; padding: 0.5em; }

    img { border-style: none; }

    dl { margin-top: 0.8em; margin-bottom: 0.8em; }
    dt { margin-top: 0.5em; margin-bottom: 0; font-style: italic; }
    dd > *:first-child { margin-top: 0; }
    ul, ol { list-style-position: outside; }

    thead { font-weight: bold; }
    tfoot { font-weight: bold; }

    *{margin:0;padding:0;}
    html,body{height:100%;color:black;}
    body{background-color:white;font:13.34px helvetica,arial,freesans,clean,sans-serif;*font-size:small;}
    table{font-size:inherit;font:100%;}
    select,input[type=text],input[type=password],input[type=image],textarea{font:99% helvetica,arial,freesans,sans-serif;}
    select,option{padding:0 .25em;}
    optgroup{margin-top:.5em;}
    input.text{padding:1px 0;}
    pre,code{font:12px Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;}
    body *{line-height:1.4em;}
    p{margin:1em 0;}
    img{border:0;}
    abbr{border-bottom:none;}

    .wikistyle h1,.wikistyle h2,.wikistyle h3,.wikistyle h4,.wikistyle h5,.wikistyle h6{border:0!important;}
    .wikistyle h1{font-size:170%!important;border-top:4px solid #aaa!important;padding-top:.5em!important;margin-top:1.5em!important;}
    .wikistyle h1:first-child{margin-top:0!important;padding-top:.25em!important;border-top:none!important;}
    .wikistyle h2{font-size:150%!important;margin-top:1.5em!important;border-top:4px solid #e0e0e0!important;padding-top:.5em!important;}
    .wikistyle h3{margin-top:1em!important;}
    .wikistyle p{margin:1em 0!important;line-height:1.5em!important;}
    .wikistyle ul{margin:1em 0 1em 2em!important;}
    .wikistyle ol{margin:1em 0 1em 2em!important;}
    .wikistyle ul ul,.wikistyle ul ol,.wikistyle ol ol,.wikistyle ol ul{margin-top:0!important;margin-bottom:0!important;}
    .wikistyle blockquote{margin:1em 0!important;border-left:5px solid #ddd!important;padding-left:.6em!important;color:#555!important;}
    .wikistyle dt{font-weight:bold!important;margin-left:1em!important;}
    .wikistyle dd{margin-left:2em!important;margin-bottom:1em!important;}
    .wikistyle table{margin:1em 0!important;}
    .wikistyle table th{border-bottom:1px solid #bbb!important;padding:.2em 1em!important;}
    .wikistyle table td{border-bottom:1px solid #ddd!important;padding:.2em 1em!important;}
    .wikistyle pre{margin:1em 0!important;font-size:90%!important;background-color:#f8f8ff!important;border:1px solid #dedede!important;padding:.5em!important;line-height:1.5em!important;color:#444!important;overflow:auto!important;}
    .wikistyle pre code{padding:0!important;font-size:100%!important;background-color:#f8f8ff!important;border:none!important;}
    .wikistyle code{font-size:90%!important;background-color:#f8f8ff!important;color:#444!important;padding:0 .2em!important;border:1px solid #dedede!important;}
    .wikistyle pre.console{margin:1em 0!important;font-size:90%!important;background-color:black!important;padding:.5em!important;line-height:1.5em!important;color:white!important;}
    .wikistyle pre.console code{padding:0!important;font-size:100%!important;background-color:black!important;border:none!important;color:white!important;}
    .wikistyle pre.console span{color:#888!important;}
    .wikistyle pre.console span.command{color:yellow!important;}

    .title { font-size: 2em; }
  </style>

  

  <!-- JQuery is needed -->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.6.1/jquery.min.js" type="text/javascript" language="javascript"></script>

</head>

<body class="wikistyle">

  <!-- Side Table of Contents -->
  <div id="sidebar" style="position: fixed; top: 10; right: 10; background: white;">
    <a href="javascript: toc_toggle();">
      <!-- TODO: find a preminatn image on web to use -->
      <!-- <img src="http://www.cdnjs.com/images/poweredbycloudflare.png" style="border: none;" alt="TOC" align="right"/> -->
    </a>

    <div id="toc_side" class="toc">
    </div>
  </div>

  <div id="container">
    <div id="header">
      <!-- TODO: find a preminatn image on web to use -->
      <!-- <img src="http://www.cdnjs.com/images/poweredbycloudflare.png" align="left" style="padding-right: 10px;" alt=""/> -->

      <div class="title">Executable Demonstrations</div>

      <h1>Table of Contents</h1>

      <div class="toc">
      </div>
    </div>

    <div id="content">
      
<h1>Executable</h1>


<h2>No Subcommmands</h2>

<p>This example demonstrates using CLI::Base to create a simple command line
interface without subcommands.</p>

<pre>require 'executable'

class NoSubCommandCLI &lt; Executable::Command

  attr :result

  def o?
    @o
  end

  def o=(flag)
    @o = flag
  end

  def call
    if o?
      @result = &quot;with&quot;
    else
      @result = &quot;without&quot;
    end
  end

end</pre>

<p>Execute the CLI on an example command line.</p>

<pre>cli = NoSubCommandCLI.run('')
cli.result.assert == 'without'</pre>

<p>Execute the CLI on an example command line.</p>

<pre>cli = NoSubCommandCLI.run('-o')
cli.result.assert == 'with'</pre>

<p>There are two important things to notices heres. Frist, that #main is being
called in each case. It is the method called with no other subcommands are
defined. And second, the fact the a `o?` method is defined to compliment
the `o=` writer, informs CLI::Base that `-o` is an option <em>flag</em>,
not taking any parameters.</p>


<h2>Multiple Subcommmands</h2>

<p>Require Executable library.</p>

<pre>require 'executable'</pre>

<p>Setup an example CLI subclass.</p>

<pre>class MyCLI &lt; Executable::Command

  attr :result

  def initialize
    @result = []
  end

  def g=(value)
    @result &lt;&lt; &quot;g&quot; if value
  end

  def g?
    @result.include?(&quot;g&quot;)
  end

  class C1 &lt; self

    def call
      @result &lt;&lt; &quot;c1&quot;
    end

    def o1=(value)
      @result &lt;&lt; &quot;c1_o1 #{value}&quot;
    end

    def o2=(value)
      @result &lt;&lt; &quot;c1_o2 #{value}&quot;
    end

  end

  class C2 &lt; Executable::Command

    attr :result

    def initialize
      @result = []
    end

    def call
      @result &lt;&lt; &quot;c2&quot;
    end

    def o1=(value)
      @result &lt;&lt; &quot;c2_o1 #{value}&quot;
    end

    def o2=(value)
      @result &lt;&lt; &quot;c2_o2&quot; if value
    end

    def o2?
      @result.include?(&quot;c2_o2&quot;)
    end

  end

end</pre>

<p>Instantiate and run the class on an example command line.</p>

<p>Just a command.</p>

<pre>cli = MyCLI.run('c1')
cli.result.assert == ['c1']</pre>

<p>Command with global option.</p>

<pre>cli = MyCLI.run('c1 -g')
cli.result.assert == ['g', 'c1']</pre>

<p>Command with an option.</p>

<pre>cli = MyCLI.run('c1 --o1 A')
cli.result.assert == ['c1_o1 A', 'c1']</pre>

<p>Command with two options.</p>

<pre>cli = MyCLI.run('c1 --o1 A --o2 B')
cli.result.assert == ['c1_o1 A', 'c1_o2 B', 'c1']</pre>

<p>Try out the second command.</p>

<pre>cli = MyCLI.run('c2')
cli.result.assert == ['c2']</pre>

<p>Seoncd command with an option.</p>

<pre>cli = MyCLI.run('c2 --o1 A')
cli.result.assert == ['c2_o1 A', 'c2']</pre>

<p>Second command with two options.</p>

<pre>cli = MyCLI.run('c2 --o1 A --o2')
cli.result.assert == ['c2_o1 A', 'c2_o2', 'c2']</pre>

<p>Since C1#main takes not arguments, if we try to issue a command that will
have left over arguments, then an ArgumentError will be raised.</p>

<pre>expect ArgumentError do
  cli = MyCLI.run('c1 a')
end</pre>

<p>How about a non-existenct subcommand.</p>

<pre>expect NotImplementedError do
  cli = MyCLI.run('q')
  cli.result.assert == ['q']
end</pre>

<p>How about an option only.</p>

<pre>expect NotImplementedError do
  cli = MyCLI.run('-g')
  cli.result.assert == ['-g']
end</pre>

<p>How about a non-existant options.</p>

<pre>expect Executable::NoOptionError do
  MyCLI.run('c1 --foo')
end</pre>


<h2>Command Help</h2>

<p>Executable Commands can generate help output. It does this by extracting
the commenst associated with the option methods. A description of the
command itself is taken from the comment on the `#call` method. Only the
first line of a comment is used, so the reset of the comment can still be
catered to documention tools such as YARD and RDoc.</p>

<p>Letâ€™s setup an example CLI subclass to demonstrate this.</p>

<pre>class MyCLI &lt; Executable::Command

  # This is global option -g.
  # Yadda yadda yadda...
  def g=(bool)
    @g = bool
  end

  def g?; @g; end

  # Subcommand `c1`.
  class C1 &lt; self

    # This does c1.
    def call(*args)
    end

    # This is option --o1 for c1.
    def o1=(value)
    end

    # This is option --o2 for c1.
    def o2=(value)
    end

  end

  # Subcommand `c2`.
  class C2 &lt; self

    # This does c2.
    def call(*args)
    end

    # This is option --o1 for c2.
    def o1=(value)
    end

    # This is option --o2 for c2.
    def o2=(value)
    end

  end

end</pre>

<h3>Plain Text</h3>

<p>The help output,</p>

<pre>@out = MyCLI::C1.help.to_s</pre>

<p>should be clearly laid out as follows:</p>

<pre>Usage: mycli-c1 [options...] [subcommand]

This does c1.

OPTIONS
   -g          This is global option -g.
  --o1=VALUE   This is option --o1 for c1.
  --o2=VALUE   This is option --o2 for c1.

Copyright (c) 2012</pre>

<h3>Markdown</h3>

<p>The help feature can also output ronn-style markdown,</p>

<pre>@out = MyCLI::C1.help.markdown</pre>

<p>should be clearly laid out as follows:</p>

<pre>mycli-c1(1) - This does c1.
===========================

## SYNOPSIS

`mycli-c1` [options...] [subcommand]

## DESCRIPTION

This does c1.

## OPTIONS

  * `-g`:
    This is global option -g.

  * `--o1=VALUE`:
    This is option --o1 for c1.

  * `--o2=VALUE`:
    This is option --o2 for c1.

## COPYRIGHT

Copyright (c) 2012</pre>


<h2>Manpage</h2>

<p>If a man page is available for a given command using the #show_help method
will automatically find the manpage and display it.</p>

<pre>sample = File.dirname(__FILE__) + '/samples'

load(sample + '/bin/hello')

manpage = Hello.cli.manpage

manpage.assert == sample + '/man/hello.1'</pre>


<h2>OptionParser Example</h2>

<p>This example mimics the one given in optparse.rb documentation.</p>

<pre>require 'executable'
require 'ostruct'
require 'time'

class ExampleCLI &lt; Executable::Command

  CODES = %w[iso-2022-jp shift_jis euc-jp utf8 binary]
  CODE_ALIASES = { &quot;jis&quot; =&gt; &quot;iso-2022-jp&quot;, &quot;sjis&quot; =&gt; &quot;shift_jis&quot; }

  attr :options

  def initialize
    super
    reset
  end

  def reset
    @options = OpenStruct.new
    @options.library = []
    @options.inplace = false
    @options.encoding = &quot;utf8&quot;
    @options.transfer_type = :auto
    @options.verbose = false
  end

  # Require the LIBRARY before executing your script
  def require=(lib)
    options.library &lt;&lt; lib
  end
  alias :r= :require=

  # Edit ARGV files in place (make backup if EXTENSION supplied)
  def inplace=(ext)
    options.inplace = true
    options.extension = ext
    options.extension.sub!(/\A\.?(?=.)/, &quot;.&quot;)  # ensure extension begins with dot.
  end
  alias :i= :inplace=

  # Delay N seconds before executing
  # Cast 'delay' argument to a Float.
  def delay=(n)
    options.delay = n.to_float
  end

  # Begin execution at given time
  # Cast 'time' argument to a Time object.
  def time=(time)
    options.time = Time.parse(time)
  end
  alias :t= :time=

  # Specify record separator (default \\0)
  # Cast to octal integer.
  def irs=(octal)
    options.record_separator = octal.to_i(8)
  end
  alias :F= :irs=

  # Example 'list' of arguments
  # List of arguments.
  def list=(args)
    options.list = list.split(',')
  end

  # Keyword completion.  We are specifying a specific set of arguments (CODES
  # and CODE_ALIASES - notice the latter is a Hash), and the user may provide
  # the shortest unambiguous text.
  CODE_LIST = (CODE_ALIASES.keys + CODES)

  help.option(:code, &quot;Select encoding (#{CODE_LIST})&quot;)

  # Select encoding
  def code=(code)
    codes = CODE_LIST.select{ |x| /^#{code}/ =~ x }
    codes = codes.map{ |x| CODE_ALIASES.key?(x) ? CODE_ALIASES[x] : x }.uniq
    raise ArgumentError unless codes.size == 1
    options.encoding = codes.first
  end

  # Select transfer type (text, binary, auto)
  # Optional argument with keyword completion.
  def type=(type)
    raise ArgumentError unless %w{text binary auto}.include(type.downcase)
    options.transfer_type = type.downcase
  end

  # Run verbosely
  # Boolean switch.
  def verbose=(bool)
    options.verbose = bool
  end
  def verbose?
    @options.verbose
  end
  alias :v= :verbose=
  alias :v? :verbose?

  # Show this message
  # No argument, shows at tail.  This will print an options summary.
  def help!
    puts help_text
    exit
  end
  alias :h! :help!

  # Show version
  # Another typical switch to print the version.
  def version?
    puts Executor::VERSION
    exit
  end

  #
  def call
    # ... main procedure here ...
  end
end</pre>

<p>We will run some scenarios on this example to make sure it works.</p>

<pre>cli = ExampleCLI.execute('-r=facets')
cli.options.library.assert == ['facets']</pre>

<p>Make sure time option parses.</p>

<pre>cli = ExampleCLI.execute('--time=2010-10-10')
cli.options.time.assert == Time.parse('2010-10-10')</pre>

<p>Make sure code lookup words and is limted to the selections provided.</p>

<pre>cli = ExampleCLI.execute('--code=ji')
cli.options.encoding.assert == 'iso-2022-jp'

expect ArgumentError do
  ExampleCLI.execute('--code=xxx')
end</pre>

<p>Ensure <tt>irs</tt> is set to an octal number.</p>

<pre>cli = ExampleCLI.execute('-F 32')
cli.options.record_separator.assert == 032</pre>

<p>Ensure extension begins with dot and inplace is set to true.</p>

<pre>cli = ExampleCLI.execute('--inplace txt')
cli.options.extension.assert == '.txt'
cli.options.inplace.assert == true</pre>


<h1>Subclass Example</h1>

<p>Lets say we have a class that we would like to work with on the command
line, but want to keep the class itself unchanaged without mixin.</p>

<pre>class Hello
  attr_accessor :name

  def initialize(name=&quot;World&quot;)
    @name = name
  end

  def hello
    @output = &quot;Hello, #{name}!&quot;
  end

  def output
    @output
  end
end</pre>

<p>Rather then including Exectuable in the class directly, we can create a
subclass and use it instead.</p>

<pre>class HelloCommand &lt; Hello
  include Executable

  def call(*args)
    hello
  end
end</pre>

<p>Now we can execute the command perfectly well.</p>

<pre>cmd = HelloCommand.execute(['hello', '--name=Fred'])
cmd.output.assert == &quot;Hello, Fred!&quot;</pre>

<p>And the original class remains undisturbed.</p>


<h1>README Example</h1>

<p>This is the example used in the documentation.</p>

<pre>class Example
  include Executable

  attr_switch :quiet

  def bread(*args)
    [&quot;bread&quot;, quiet?, *args]
  end

  def butter(*args)
    [&quot;butter&quot;, quiet?, *args]
  end

  # Route call to methods.
  def call(name, *args)
    meth = public_method(name)
    meth.call(*args)
  end
end</pre>

<p>Use a subcommand and an argument.</p>

<pre>c, a = Example.parse(['butter', 'yum'])
r = c.call(*a)
r.assert == [&quot;butter&quot;, nil, &quot;yum&quot;]</pre>

<p>A subcommand and a boolean option.</p>

<pre>c, a = Example.parse(['bread', '--quiet'])
r = c.call(*a)
r.assert == [&quot;bread&quot;, true]</pre>






    </div>
  </div>

  <br/><br/><br/>
</body>

</html>

<script src="../assets/scripts/spec.js" type="text/javascript" language="javascript"></script>

<script type="text/javascript" language="javascript">
  /*****************************************************************
   * $.toc()
   * by rebecca murphey
   * rmurphey gmail com
   *
   * This function is called on its own and takes as an argument
   * a list of selectors with which it will build a table of
   * contents. 
   *
   * The first selector will make up the top level of the TOC;
   * the second selector will make up the second level of the TOC;
   * etc.
   *
   * This function returns a div containing nested unordered lists;
   * each list item is linked to an anchor tag added before the item
   * on the page.
   *
   * usage: $.toc('h1,h2,h3').prependTo('body');
   ************************************************************************/
  (function($) { 
    $.toc = function(tocList) {
      $(tocList).addClass('jquery-toc');
      var tocListArray = tocList.split(',');
      $.each(tocListArray, function(i,v) { tocListArray[i] = $.trim(v); });
      var $elements = $('.jquery-toc');
      $('body').append('<div></div>');
      var $toc = $('body div:last');
      var lastLevel = 1;
      $toc.append('<ul class="jquery-toc-1"></ul>');
      $elements.each(function() {
        var $e = $(this);
        var text = $e.text();
        var anchor = text.replace(/ /g,'-');
        $e.before('<a name="' + anchor + '"></a>');
        var level;
        $.each(tocListArray, function(i,v) { 
          if (v.match(' ')) {
            var vArray = v.split(' '); 
            var e = vArray[vArray.length - 1];
          } else { e = v; }
          if ($e.is(e)) { level = i+1; } 
        });
        var className = 'jquery-toc-' + level;
        var li = '<li><a href="#' + anchor + '">' + text + '</a></li>';
        if (level == lastLevel) {
          $('ul.' + className + ':last',$toc).append(li);
        } else if (level > lastLevel) {
          var parentLevel = level - 1;
          var parentClassName = 'jquery-toc-' + parentLevel;
          $('ul.' + parentClassName + ':last',$toc).
            append('<ul class="' + className + '"></ul>');
          $('ul.' + className + ':last',$toc).append(li);
        } else if (level < lastLevel) {
          $('ul.' + className + ':last',$toc).append(li);
        }
        lastLevel = level;
      });
      var $toc_ul = $('ul.jquery-toc-1',$toc);
      $toc.remove();
      return($toc_ul);
   }
  })(jQuery);
</script>

<script>
  function toc_toggle() {
    $('#toc_side').toggle();
    $("pre").addClass("pass");
    $("pre:contains('FAIL:')").addClass("fail");
    $("pre:contains('ERROR:')").addClass("error");
  };

  $.toc('#content h1,h2,h3,h4').appendTo('.toc');

  toc_toggle();
</script>

